<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSC - Connected Smart Cities</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        /* Header */
        .header {
            display: flex;
            align-items: center;
            padding: 20px 40px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #eee;
            position: relative;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .back-button {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #513C9A;
            font-size: 16px;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            position: absolute;
            left: 40px;
        }

        .back-button:hover {
            color: #6B4FB5;
        }

        .logo-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(45deg, #513C9A, #6B4FB5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            color: white;
        }
        
        .logo-text {
            font-size: 24px;
            font-weight: bold;
            color: #513C9A;
        }

        /* Main Content */
        .main-content {
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Page Title */
        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            color: #513C9A;
            font-size: 42px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-title p {
            color: #666;
            font-size: 18px;
        }

        /* Purple Sections */
        .purple-section {
            background: linear-gradient(135deg, #513C9A 0%, #6B4FB5 100%);
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
            transition: all 0.5s ease;
            color: white;
            box-shadow: 0 10px 30px rgba(81, 60, 154, 0.2);
        }

        .section-content {
            position: relative;
            z-index: 2;
        }

        .section-title {
            color: white;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 16px;
            text-align: center;
        }

        .section-subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 16px;
            margin-bottom: 32px;
            text-align: center;
        }

        /* Municipality Selection - Always Visible */
        .municipality-selection-fixed {
            background: linear-gradient(135deg, #513C9A 0%, #6B4FB5 100%);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 20px;
            color: white;
            box-shadow: 0 10px 30px rgba(81, 60, 154, 0.2);
        }

        .municipality-dropdowns {
            display: flex;
            gap: 24px;
            flex-wrap: wrap;
            justify-content: center;
            margin-bottom: 20px;
        }

        .municipality-select-container {
            position: relative;
            min-width: 250px;
        }

        .municipality-select {
            background: white;
            color: #333;
            border: 2px solid #ddd;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 16px;
            font-family: 'Poppins', sans-serif;
            cursor: pointer;
            min-width: 200px;
            transition: all 0.3s;
            width: 100%;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .municipality-select:focus {
            outline: none;
            border-color: #513C9A;
            box-shadow: 0 0 0 3px rgba(81, 60, 154, 0.1);
        }

        .municipality-select:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Buttons */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .action-button {
            background: linear-gradient(45deg, #513C9A, #6B4FB5);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(81, 60, 154, 0.3);
            font-family: 'Poppins', sans-serif;
            font-size: 16px;
            min-width: 200px;
        }

        .action-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(81, 60, 154, 0.4);
        }

        .action-button.secondary {
            background: white;
            color: #513C9A;
            border: 2px solid #513C9A;
        }

        .action-button.danger {
            background: #dc3545;
            color: white;
            border: 2px solid #dc3545;
        }

        .action-button.danger:hover {
            background: #c82333;
            border-color: #c82333;
        }

        /* City Header */
        .city-header {
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(90deg, #513C9A, #6B4FB5);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(81, 60, 154, 0.3);
        }

        .city-name {
            font-size: 2.5rem;
            font-weight: bold;
            text-align: center;
        }

        /* City Ranking Info */
        .city-ranking-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .ranking-item {
            text-align: center;
            background: rgba(255, 255, 255, 0.15);
            padding: 15px;
            border-radius: 12px;
            min-width: 120px;
        }

        .ranking-year {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .ranking-position {
            font-size: 24px;
            font-weight: bold;
        }

        /* Axis Grid */
        .axis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .axis-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            border-left: 5px solid #513C9A;
            transition: all 0.3s ease;
            border: 1px solid #ddd;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .axis-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(81, 60, 154, 0.2);
        }

        .axis-title {
            font-weight: bold;
            margin-bottom: 15px;
            color: #513C9A;
            font-size: 1.1rem;
        }

        .axis-values {
            display: flex;
            justify-content: space-between;
        }

        .year-value {
            text-align: center;
            flex: 1;
        }

        .year {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 5px;
        }

        .value {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .out-of-range {
            color: #e74c3c;
            font-size: 0.9rem;
        }

        /* Indicators Table */
        .table-container {
            background: white;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid #ddd;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .indicators-table {
            width: 100%;
            border-collapse: collapse;
        }

        .indicators-table th {
            background: linear-gradient(90deg, #513C9A, #6B4FB5);
            color: white;
            padding: 15px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 0.9rem;
        }

        .indicators-table td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: 0.85rem;
        }

        .indicators-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .indicators-table tr:hover {
            background-color: rgba(81, 60, 154, 0.05);
        }

        /* Eixo badges */
        .eixo-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            color: white;
            margin-right: 5px;
        }

        .eixo-SAU { background-color: #9b59b6; }
        .eixo-GOV { background-color: #8e44ad; }
        .eixo-MOB { background-color: #f1c40f; color: #333; }
        .eixo-URB { background-color: #1abc9c; }
        .eixo-MAM { background-color: #e74c3c; }
        .eixo-EMP { background-color: #f39c12; }
        .eixo-ECO { background-color: #e67e22; }
        .eixo-EDU { background-color: #e74c3c; }
        .eixo-TIC { background-color: #3498db; }
        .eixo-SEG { background-color: #27ae60; }
        .eixo-ENE { background-color: #f1c40f; color: #333; }

        /* Charts Section */
        .charts-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Trends summary cards (improving / worsening / stable) */
        .trends-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 18px;
            margin: 16px 0 24px 0;
        }

        .trends-card {
            background: white;
            padding: 18px;
            border-radius: 12px;
            border-left: 4px solid var(--trend-color);
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
        }

        .trends-card.improving { --trend-color: #28a745; }
        .trends-card.worsening { --trend-color: #dc3545; }
        .trends-card.stable { --trend-color: #6c757d; }

        .trends-icon { font-size: 22px; margin-bottom: 8px; }
        .trends-number { font-size: 26px; font-weight: 700; color: var(--trend-color); margin-bottom: 6px; }
        .trends-label { color: #666; font-size: 13px; }

        .charts-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 30px;
            color: #513C9A;
            font-weight: bold;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
        }

        .chart-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .chart-card h4 {
            color: #513C9A;
            font-size: 1.1rem;
            margin-bottom: 15px;
            text-align: center;
            line-height: 1.3;
        }

        .chart-card canvas {
            max-height: 300px;
        }

        /* Ranking Section */
        .ranking-section {
            background: white;
            border-radius: 16px;
            padding: 30px;
            margin-top: 30px;
            border: 1px solid #ddd;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .ranking-controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        /* Tab content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Hidden sections */
        .hidden {
            display: none;
        }

        /* Selection Display */
        .selection-display {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
            text-align: center;
            color: white;
            display: none;
        }

        .selection-display.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* White Sections */
        .white-section {
            background: white;
            border-radius: 16px;
            padding: 40px;
            margin-bottom: 40px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .white-section-title {
            color: #513C9A;
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 32px;
        }

        /* Gráficos por eixo */
        .axis-charts-section {
            margin-bottom: 40px;
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .axis-charts-header {
            background: #513C9A;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            font-size: 18px;
            font-weight: 600;
            text-align: center;
        }

        .axis-charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        /* Small highlight for selected summary/ranking toggle */
        .summary-toggle .action-button.active {
            box-shadow: 0 6px 20px rgba(81,60,154,0.4);
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 992px) {
            .main-content {
                padding: 20px;
            }
            
            .page-title h1 {
                font-size: 36px;
            }
            
            .city-header {
                flex-direction: column;
                gap: 20px;
            }

            .axis-grid {
                grid-template-columns: 1fr;
            }

            .charts-grid {
                grid-template-columns: 1fr;
            }

            .indicators-table {
                font-size: 0.8rem;
            }

            .indicators-table th,
            .indicators-table td {
                padding: 8px 5px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .municipality-dropdowns {
                flex-direction: column;
                align-items: center;
            }

            .municipality-select-container {
                width: 100%;
                max-width: 300px;
            }

            .axis-charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
   <div class="container">
        
        <div class="header">
            <a href="#" class="back-button" onclick="resetPage()">
                ← Voltar para Plataformas
            </a>
           <div class="logo-header">
            <img src="img/logo.png" alt="DataCity Logo" />
            </div>
        </div>

    <!-- Main Content -->
    <div class="main-content">
        <!-- Page Title -->
        <div class="page-title">
            <h1>CSC - Connected Smart Cities</h1>
            <p>Monitoramento e avaliação de indicadores urbanos</p>
        </div>

        <!-- Fixed Municipality Selection (Always Visible) -->
        <div class="municipality-selection-fixed">
            <h2 class="section-title">Selecione um município</h2>
            <p class="section-subtitle">Escolha o município para visualizar os indicadores CSC</p>
            
            <div class="municipality-dropdowns">
                <div class="municipality-select-container">
                    <select id="uf-select" class="municipality-select" onchange="selectUF()">
                        <option value="">Carregando estados...</option>
                    </select>
                </div>
                <div class="municipality-select-container">
                    <select id="municipality-select" class="municipality-select" onchange="selectMunicipality()" disabled>
                        <option value="">Primeiro selecione o estado</option>
                    </select>
                </div>
            </div>

            <div class="selection-display" id="selection-display">
                <h3>Município Selecionado:</h3>
                <p id="selection-text"></p>
            </div>
            
            <div class="action-buttons">
                <button class="action-button danger" onclick="clearSelection()">🗑️ Limpar Seleção</button>
            </div>
        </div>

        <!-- CSC Summary (visible quando nenhum município estiver selecionado) -->
        <div id="csc-summary" class="white-section">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap;">
                <div class="summary-toggle" style="display:flex; gap:10px;">
                    <button id="btn-summary" class="action-button secondary active" onclick="showCSCSummaryView()" style="min-width:160px;">Resumo CSC</button>
                    <button id="btn-ranking" class="action-button secondary" onclick="showCSCRankingView()" style="min-width:180px;">Visualizar Ranking CSC</button>
                </div>
            </div>
            <p style="text-align:center; color:#666; margin-bottom:18px;">Visão geral dos indicadores do Connected Smart Cities. Selecione um município para ver dados locais.</p>
            <div id="csc-summary-stats" style="display:flex; gap:20px; flex-wrap:wrap; justify-content:center; align-items:flex-start;"></div>
            <div id="csc-summary-axisgrid" class="axis-grid" style="margin-top:18px;"></div>
        </div>

        <!-- Municipality Dashboard -->
        <div id="municipality-dashboard" class="hidden">
            <!-- City Header -->
            <div class="city-header">
                <div>
                    <div class="city-name" id="selected-municipality">Londrina - PR</div>
                    <div class="city-ranking-info" id="city-ranking-info">
                        <div class="ranking-item">
                            <div class="ranking-year">Ranking CSC 2024</div>
                            <div class="ranking-position">24°</div>
                        </div>
                        <div class="ranking-item">
                            <div class="ranking-year">Ranking CSC 2023</div>
                            <div class="ranking-position">19°</div>
                        </div>
                        <div class="ranking-item">
                            <div class="ranking-year">Ranking CSC 2022</div>
                            <div class="ranking-position">24°</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- View Selection Dropdown -->
                <div class="purple-section" style="margin-bottom: 10px;">
                    <div class="section-content">
                        <div class="municipality-dropdowns dashboard-view-dropdowns" style="justify-content: flex-start;">
                            <div style="max-width:340px; width:100%;">
                                <select id="municipality-view-selector" class="municipality-select" onchange="changeView()" style="min-width: 220px; max-width: 320px; width:100%;">
                                    <option value="axes">Posição por Eixo</option>
                                    <option value="indicators">Indicadores do Município</option>
                                    <option value="charts">Gráficos e Análises</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

            <!-- Axes Tab -->
            <div id="axes" class="tab-content active">
                <div class="axis-grid">
                    <!-- Eixos serão preenchidos via JavaScript -->
                </div>
            </div>

            <!-- Indicators Tab -->
            <div id="indicators" class="tab-content">
                <div class="table-container">
                    <div style="padding: 20px; background: #f8f9fa; border-bottom: 1px solid #eee;">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <select id="axis-filter" class="municipality-select" style="flex: 1; min-width: 200px;" onchange="filterIndicators()">
                                <option value="">Filtrar por eixo</option>
                                <option value="SAU">Saúde</option>
                                <option value="GOV">Governança</option>
                                <option value="MOB">Mobilidade</option>
                                <option value="URB">Urbanismo</option>
                                <option value="MAM">Meio Ambiente</option>
                                <option value="EMP">Empreendedorismo</option>
                                <option value="ECO">Economia</option>
                                <option value="EDU">Educação</option>
                                <option value="TIC">Tecnologia</option>
                                <option value="SEG">Segurança</option>
                            </select>
                            <input type="text" id="indicator-search" class="municipality-select" style="flex: 2; min-width: 300px;" placeholder="Filtrar por indicador" oninput="filterIndicators()">
                        </div>
                    </div>
                    <table class="indicators-table">
                        <thead>
                            <tr>
                                <th>Indicador</th>
                                <th>Eixo</th>
                                <th>2022</th>
                                <th>2023</th>
                                <th>2024</th>
                                <th>Unidade</th>
                                <th>Fonte</th>
                            </tr>
                        </thead>
                        <tbody id="indicators-tbody">
                            <!-- Indicators will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Charts Tab -->
            <div id="charts" class="tab-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <select id="chart-axis-filter" class="municipality-select" onchange="filterChartsByAxis()" style="min-width: 200px; margin-right: 20px;" disabled>
                        <option value="">Todos os Eixos</option>
                        <option value="SAU">Saúde</option>
                        <option value="GOV">Governança</option>
                        <option value="MOB">Mobilidade</option>
                        <option value="URB">Urbanismo</option>
                        <option value="MAM">Meio Ambiente</option>
                        <option value="EMP">Empreendedorismo</option>
                        <option value="ECO">Economia</option>
                        <option value="EDU">Educação</option>
                        <option value="TIC">Tecnologia</option>
                        <option value="SEG">Segurança</option>
                    </select>
                    <button class="action-button" onclick="generateCharts()">📊 Gerar Gráficos de Evolução</button>
                </div>
                <div class="charts-section" id="charts-section" style="display: none;">
                    <h3 class="charts-title">📈 Evolução dos Indicadores CSC (2022-2024)</h3>
                    <div id="charts-container">
                        <!-- Charts will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Future Implementation Message -->
        <div id="future-implementation-message" class="white-section hidden">
            <h2 class="white-section-title">Implementação Futura</h2>
            <p style="text-align: center; font-size: 16px; color: #666; margin: 20px 0;">
                No momento, apenas a cidade de Londrina-PR possui dados disponíveis.<br>
                Estamos trabalhando para incluir mais municípios em breve.
            </p>
        </div>

    <!-- General Ranking Section (hidden by default; shown only when requested) -->
    <div id="ranking-section" class="ranking-section hidden">
            <h2 style="text-align: center; color: #513C9A; margin-bottom: 20px;">Ranking Geral CSC 2024</h2>
            
            <div class="ranking-controls">
                <select id="ranking-year" class="municipality-select" style="flex: 1;" onchange="filterRanking()">
                    <option value="2024">Ranking Geral 2024</option>
                    <option value="2023">Ranking Geral 2023</option>
                    <option value="2022">Ranking Geral 2022</option>
                </select>
                <select id="ranking-region" class="municipality-select" style="flex: 1;" onchange="filterRanking()">
                    <option value="">Todas as regiões</option>
                    <option value="Sul">Sul</option>
                    <option value="Sudeste">Sudeste</option>
                    <option value="Centro-Oeste">Centro-Oeste</option>
                    <option value="Nordeste">Nordeste</option>
                    <option value="Norte">Norte</option>
                </select>
                <select id="ranking-uf" class="municipality-select" style="flex: 1;" onchange="filterRanking()">
                    <option value="">Todos os estados</option>
                    <!-- Estados serão preenchidos via JavaScript -->
                </select>
                <select id="ranking-size" class="municipality-select" style="flex: 1;" onchange="filterRanking()">
                    <option value="">Todos os portes</option>
                    <option value="+500 mil">+500 mil</option>
                    <option value="100 a 500 mil">100 a 500 mil</option>
                    <option value="50 a 100 mil">50 a 100 mil</option>
                </select>
            </div>
            
            <div class="table-container">
                <table class="indicators-table">
                    <thead>
                        <tr>
                            <th>Posição</th>
                            <th>UF</th>
                            <th>Município</th>
                            <th>Nota</th>
                            <th>Porte</th>
                            <th>Região</th>
                        </tr>
                    </thead>
                    <tbody id="ranking-tbody">
                        <!-- Ranking data will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        // Complete indicators data from both files
        const indicatorsData = [
            // Saúde (SAU)
            { name: "Agendamento de consulta na rede pública de saúde", eixo: "SAU", values: ["Sim", "Sim", "Sim"], unit: "Sim/Não", fonte: "IBGE - Perfil de Municípios" },
            { name: "Leitos / Mil Habitantes", eixo: "SAU", values: [3.35, 3.47, 3.78], unit: "leitos/1.000 habitantes", fonte: "Datasus" },
            { name: "Despesa Municipal Per Capita Paga Com Saúde", eixo: "SAU", values: [1301.79, 1288.44, 1486.34], unit: "R$/Habitante", fonte: "Siconfi" },
            { name: "Médicos / 100 Mil Habitantes", eixo: "SAU", values: [349.13, 424.33, 416.96], unit: "médicos/100 mil habitantes", fonte: "CNES" },
            { name: "Mortes Em Acidente De Trânsito / 100 Mil Habitantes", eixo: "SAU", values: [23.1, 21.0, 21.0], unit: "óbito/100 mil habitantes", fonte: "Datasus" },
            { name: "Óbitos / Mil Nascidos Vivos (Local De Residência)", eixo: "SAU", values: [9.1, 8.1, 8.7], unit: "óbito/1.000 nascido vivos", fonte: "Datasus" },
            { name: "Percentual Da Cobertura Populacional Da Equipe De Saúde Da Família", eixo: "SAU", values: [58, 63, 67], unit: "%", fonte: "NOVO" },

            // Governança (GOV)
            { name: "Atendimento ao Cidadão - Aplicativo Criado pela Prefeitura", eixo: "GOV", values: ["Não", "Não", "Não"], unit: "Sim/Não", fonte: "IBGE - Perfil de Municípios" },
            { name: "Número De Conselhos", eixo: "GOV", values: [7, 6, 6], unit: "#", fonte: "IBGE - Perfil de Municípios" },
            { name: "Escala Brasil Transparente", eixo: "GOV", values: [10.00, 10.00, 10.00], unit: "NOTA", fonte: "CGU" },
            { name: "Escolaridade Do Prefeito", eixo: "GOV", values: [10, 8, 8], unit: "NOTA", fonte: "IBGE / TSE - Perfil do Candidato" },
            { name: "Índice Firjan Of Desenvolvimento Municipal - IFDM", eixo: "GOV", values: [0.848, 0.848, 0.848], unit: "NOTA", fonte: "Firjan" },

            // Mobilidade (MOB)
            { name: "Bilhete eletrônico transporte público", eixo: "MOB", values: ["Sim", "Sim", "Sim"], unit: "Sim/Não", fonte: "IBGE - Perfil de Municípios" },
            { name: "Ciclovias", eixo: "MOB", values: [6.95, 10.10, 12.05], unit: "KMS / 100 MIL HABITANTES", fonte: "Pesquisa Urban Systems" },
            { name: "Idade Média Da Frota De Veículos", eixo: "MOB", values: [16.8, 17.4, 18.11], unit: "anos", fonte: "Senatran" },
            { name: "Nº de aeroportos com voos regulares em raio de 100 km", eixo: "MOB", values: [2, 2, 2], unit: "Aeroportos", fonte: "Horans" },
            { name: "Ônibus / Automóveis", eixo: "MOB", values: [0.01, 0.01, 0.01], unit: "bus / auto", fonte: "Senatran" },
            { name: "Outros Modais De Transporte Coletivo (kms)", eixo: "MOB", values: [0.00, 0.01, 0.01], unit: "KMS / 100 MIL HABITANTES", fonte: "Pesquisa Urban Systems" },
            { name: "Proporção De Automóveis / Habitantes", eixo: "MOB", values: [0.42, 0.45, 0.45], unit: "auto / habitantes", fonte: "Senatran" },
            { name: "Transporte Rodoviário - Conexões Interestaduais", eixo: "MOB", values: [11, 47, 50], unit: "Seções Interestaduais", fonte: "ANTT" },
            { name: "Percentagem de veículos matriculados na cidade que são veículos de baixa emissão", eixo: "MOB", values: [12.53, 0.19, 0.34], unit: "% do total", fonte: "Senatran" },

            // Urbanismo (URB)
            { name: "Cadastro Imobiliário", eixo: "URB", values: ["I - G - DC", "10", "10"], unit: "NOTA", fonte: "IBGE - Perfil de Municípios" },
            { name: "Lei De Plano Diretor Estratégico Municipal", eixo: "URB", values: [5, 10, 10], unit: "NOTA", fonte: "IBGE - Perfil de Municípios" },
            { name: "Lei Sobre Operação Urbana Consorciada", eixo: "URB", values: [10, 10, 10], unit: "NOTA", fonte: "IBGE - Perfil de Municípios" },
            { name: "Lei Sobre Zoneamento Ou Uso E Ocupação Do Solo", eixo: "URB", values: [10, 10, 10], unit: "NOTA", fonte: "IBGE - Perfil de Municípios" },
            { name: "Emissão De Certidão Negativa Of Débito E Alvará No Site Da Prefeitura", eixo: "URB", values: ["Sim", "Sim", "Sim"], unit: "Sim ou Não", fonte: "IBGE - Perfil de Municípios" },
            { name: "Despesa Municipal Per Capta Paga Com Urbanismo", eixo: "URB", values: [256.29, 276.74, 330.75], unit: "R$ por Habitante", fonte: "Siconfi" },
            { name: "Percentagem Da População Da Cidade Que Vive Em Densidades Populacionais Médias A Altas", eixo: "URB", values: [97.4, 97.4, 97.4], unit: "%", fonte: "IBGE - Urban Systems" },
            { name: "Semáforos inteligentes", eixo: "URB", values: ["Sim", "Sim", "Sim"], unit: "Sim ou Não", fonte: "IBGE - Perfil de Municípios" },

            // Meio Ambiente (MAM)
            { name: "Cobertura Do Serviço De Coleta De Resíduos", eixo: "MAM", values: [99, 99, 89], unit: "%", fonte: "SNIS" },
            { name: "Monitoramento De Área De Risco", eixo: "MAM", values: ["Não", "Não", "Não"], unit: "S / N", fonte: "Cemaden" },
            { name: "Índice De Atendimento Urbano Of Água - IN023_AE", eixo: "MAM", values: [100.0, 100.0, 100.0], unit: "%", fonte: "SNIS" },
            { name: "Índice De Atendimento Urbano Of Esgoto - IN024_AE", eixo: "MAM", values: [100.0, 100.0, 100.0], unit: "%", fonte: "SNIS" },
            { name: "Índice De Perdas Na Distribuição Of Água - IN049_AE", eixo: "MAM", values: [34, 33, 34], unit: "%", fonte: "SNIS" },
            { name: "Índice De Recuperação Of Materiais Recicláveis - IN031RS", eixo: "MAM", values: [6.0, 6.0, 4.7], unit: "%", fonte: "SNIS" },
            { name: "Índice De Tratamento De Esgoto - IN046_AE", eixo: "MAM", values: [92.0, 89.7, 89.1], unit: "%", fonte: "SNIS" },
            { name: "Produção De Energia Em Usinas De Biomassa", eixo: "MAM", values: [0.000, 0.000, 0.000], unit: "KW", fonte: "Aneel" },
            { name: "Produção De Energia Em Usinas De Energia Eólica", eixo: "MAM", values: [0.000, 0.000, 0.000], unit: "KW", fonte: "Aneel" },
            { name: "Produção De Energia Em Usinas Foto Voltaicas", eixo: "MAM", values: [208.000, 208.000, 208.000], unit: "KW", fonte: "Aneel" },
            { name: "Percentual Da Quantidade Total De Resíduos Plásticos Recuperados Na Cidade", eixo: "MAM", values: [0.29, 0.29, 5.53], unit: "%", fonte: "SNIS / Urban Systems" },

            // Empreendedorismo (EMP)
            { name: "Crescimento Das Empresas De Economia Criativa", eixo: "EMP", values: [-0.47, 9.42, 19.47], unit: "%", fonte: "RAIS" },
            { name: "Crescimento Das Empresas De Tecnologia", eixo: "EMP", values: [9.52, 4.35, 13.2], unit: "%", fonte: "RAIS" },
            { name: "Crescimento Do Número De Meis", eixo: "EMP", values: [18.62, 14.47, 8.2], unit: "%", fonte: "Portal do Empreendedor" },
            { name: "Número De Incubadoras De Empresas", eixo: "EMP", values: [2, 0, 3], unit: "incubadoras", fonte: "Anprotec" },
            { name: "Número De Parques Tecnológicos", eixo: "EMP", values: [2, 1, 1], unit: "Parques", fonte: "MCTI - 2023 inovação" },

            // Economia (ECO)
            { name: "Crescimento Do Número De Empregos", eixo: "ECO", values: [5.1, 5.5, 4.2], unit: "%", fonte: "CAGED" },
            { name: "Crescimento Do Número De Empresas", eixo: "ECO", values: [-2.51, 3.18, 9.69], unit: "%", fonte: "RAIS" },
            { name: "C crescimento Do Pib Per Capta", eixo: "ECO", values: [7.15, -0.35, 7.7], unit: "%", fonte: "IBGE" },
            { name: "Empregabilidade (Empregos / PEA)", eixo: "ECO", values: [0.37, 0.39, 0.42], unit: "pessoas / emprego", fonte: "RAIS / IBGE" },
            { name: "Independência Do Setor Público", eixo: "ECO", values: [93.5, 93.3, 93.8], unit: "%", fonte: "RAIS" },
            { name: "Receita Total Não Oriunda De Transferências", eixo: "ECO", values: [58, 59, 59], unit: "%", fonte: "Siconfi" },
            { name: "Renda Média Dos Trabalhadores Formais", eixo: "ECO", values: [2744.93, 3112.39, 3232.02], unit: "R$", fonte: "RAIS" },

            // Educação (EDU)
            { name: "Matrícula escolar na rede pública online", eixo: "EDU", values: ["Não", "Sim", "Sim"], unit: "Sim ou Não", fonte: "IBGE - Perfil de Municípios" },
            { name: "Média De Alunos Por Turma (9º ano público)", eixo: "EDU", values: [29.3, 31.1, 30.7], unit: "Média", fonte: "INEP" },
            { name: "Média De Hora-Aula Diária (Público - 9º Ano)", eixo: "EDU", values: [4.5, 4.8, 5.2], unit: "horas", fonte: "INEP" },
            { name: "Média Enem - Alunos Das Escolas Públicas", eixo: "EDU", values: [405.6, 447.4, 377.5], unit: "Média", fonte: "INEP" },
            { name: "Despesa Municipal Per Capta Paga Com Educação", eixo: "EDU", values: [680.08, 920.51, 1112.39], unit: "R$/Habitante", fonte: "Siconfi" },
            { name: "Ideb (Anos Finais) - Público", eixo: "EDU", values: [5.3, 5.3, 5.3], unit: "NOTA", fonte: "INEP" },
            { name: "Número De Computadores, Laptops, Tablets Ou Outros Dispositivos Digitais De Aprendizagem Disponíveis Por 1000 Alunos", eixo: "EDU", values: [2.3, 77.9, 59.4], unit: "aparelhos / 1000 alunos", fonte: "INEP" },
            { name: "Percentual Dos Docentes Do Ensino Médio Que Possuem Ensino Superior", eixo: "EDU", values: [99.30, 97.90, 99.20], unit: "%", fonte: "INEP" },
            { name: "Percentual Dos Trabalhadores Formais Com Ensino Superior", eixo: "EDU", values: [26.5, 26.1, 25.3], unit: "%", fonte: "RAIS" },
            { name: "Percentual Da Força De Trabalho Ocupada No Setor Educação E P&D", eixo: "EDU", values: [8.55, 8.18, 8.59], unit: "%", fonte: "RAIS" },
            { name: "Taxa De Abandono (1º Colegial - Público)", eixo: "EDU", values: [1.30, 5.30, 5.30], unit: "%", fonte: "INEP" },
            { name: "Vagas Em Universidade Pública 2022", eixo: "EDU", values: [10.50, 10.61, 11.55], unit: "", fonte: "INEP / IBGE" },

            // Tecnologia e Inovação (TIC)
            { name: "Densidade de Banda Larga Fixa", eixo: "TIC", values: [34.47, 38.08, 36.41], unit: "%", fonte: "Anatel" },
            { name: "Grandes Operadoras De Fibra Ótica", eixo: "TIC", values: [6, 6, 6], unit: "", fonte: "Anatel" },
            { name: "Percentual dos Moradores Cobertos por Cobertura 5G no município", eixo: "TIC", values: ["", 95.09, 96.13], unit: "%", fonte: "Anatel" },
            { name: "Percentual Da Força De Trabalho Ocupada No Setor Tic", eixo: "TIC", values: [4.03, 4.32, 4.44], unit: "%", fonte: "RAIS" },
            { name: "Sistema de iluminação inteligente", eixo: "TIC", values: ["Sim", "Sim", "Sim"], unit: "", fonte: "IBGE - Perfil de Municípios" },
            { name: "Velocidade Média das Conexões contratadas", eixo: "TIC", values: [170.0, 222.2, 323.4], unit: "Mbps", fonte: "Anatel" },

            // Segurança (SEG)
            { name: "Centro de controle e operações", eixo: "SEG", values: ["Sim", "Sim", "Sim"], unit: "", fonte: "IBGE - Perfil de Municípios" },
            { name: "Despesa Municipal Per Capta Paga Com Segurança", eixo: "SEG", values: [34.42, 45.50, 59.56], unit: "", fonte: "Siconfi" },
            { name: "Homicídios / 100 Mil Habitantes", eixo: "SEG", values: [28.6, 21.2, 104.0], unit: "óbito / 100 mil habitantes", fonte: "Datasus" },
            { name: "Policiais, Guardas-Civis Municipais E Agentes De Trânsito Por 100 Mil Habitantea", eixo: "SEG", values: [18.4, 19.1, 19.1], unit: "policiais / 100 mil habitantes", fonte: "RAIS" }
        ];

        // Eixos data
        const eixosData = [
            { name: "🏥 Saúde", eixo: "SAU", positions: [23, 22, 21] },
            { name: "🚌 Mobilidade", eixo: "MOB", positions: [44, 38, 45] },
            { name: "🌱 Meio Ambiente", eixo: "MAM", positions: [58, 71, 58] },
            { name: "🏛️ Governança", eixo: "GOV", positions: ["Fora 100+", "Fora 100+", "Fora 100+"] },
            { name: "💼 Empreendedorismo", eixo: "EMP", positions: [13, "Fora 100+", 25] },
            { name: "🎓 Educação", eixo: "EDU", positions: ["Fora 100+", 29, 50] },
            { name: "💰 Economia", eixo: "ECO", positions: [32, 38, 56] },
            { name: "🏗️ Urbanismo", eixo: "URB", positions: [34, 6, 13] },
            { name: "💻 Tecnologia e Inovação", eixo: "TIC", positions: [13, 11, 17] },
            { name: "🛡️ Segurança", eixo: "SEG", positions: ["Fora 100+", "Fora 100+", "Fora 100+"] }
        ];

        // Ranking data
        const rankingData = [
            { position: 1, uf: "SC", municipio: "Florianópolis", nota: 37.525, porte: "+500 mil", regiao: "Sul" },
            { position: 2, uf: "ES", municipio: "Vitória", nota: 37.513, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 3, uf: "SP", municipio: "São Paulo", nota: 36.828, porte: "+500 mil", regiao: "Sudeste" },
            { position: 4, uf: "PR", municipio: "Curitiba", nota: 36.808, porte: "+500 mil", regiao: "Sul" },
            { position: 5, uf: "RJ", municipio: "Niterói", nota: 36.765, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 6, uf: "SC", municipio: "Balneário Camboriú", nota: 36.699, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 7, uf: "SP", municipio: "São Caetano do Sul", nota: 36.164, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 8, uf: "MG", municipio: "Belo Horizonte", nota: 35.705, porte: "+500 mil", regiao: "Sudeste" },
            { position: 9, uf: "SP", municipio: "Barueri", nota: 35.579, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 10, uf: "BA", municipio: "Salvador", nota: 35.364, porte: "+500 mil", regiao: "Nordeste" },
            { position: 11, uf: "SP", municipio: "Jaguariúna", nota: 35.180, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 12, uf: "SP", municipio: "Santana de Parnaíba", nota: 35.040, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 13, uf: "RJ", municipio: "Rio de Janeiro", nota: 34.988, porte: "+500 mil", regiao: "Sudeste" },
            { position: 14, uf: "SP", municipio: "Santos", nota: 34.921, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 15, uf: "MS", municipio: "Campo Grande", nota: 34.804, porte: "+500 mil", regiao: "Centro-Oeste" },
            { position: 16, uf: "CE", municipio: "Fortaleza", nota: 34.388, porte: "+500 mil", regiao: "Nordeste" },
            { position: 17, uf: "SP", municipio: "Jundiaí", nota: 34.101, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 18, uf: "DF", municipio: "Brasília", nota: 34.072, porte: "+500 mil", regiao: "Centro-Oeste" },
            { position: 19, uf: "SC", municipio: "Jaraguá do Sul", nota: 34.054, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 20, uf: "SP", municipio: "Campinas", nota: 34.052, porte: "+500 mil", regiao: "Sudeste" },
            { position: 21, uf: "PE", municipio: "Recife", nota: 34.017, porte: "+500 mil", regiao: "Nordeste" },
            { position: 22, uf: "GO", municipio: "Goiânia", nota: 34.011, porte: "+500 mil", regiao: "Centro-Oeste" },
            { position: 23, uf: "PR", municipio: "Maringá", nota: 34.004, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 24, uf: "PR", municipio: "Londrina", nota: 33.667, porte: "+500 mil", regiao: "Sul" },
            { position: 25, uf: "SP", municipio: "Sorocaba", nota: 33.468, porte: "+500 mil", regiao: "Sudeste" },
            { position: 26, uf: "PR", municipio: "Pato Branco", nota: 33.308, porte: "50 a 100 mil", regiao: "Sul" },
            { position: 27, uf: "SC", municipio: "Blumenau", nota: 33.216, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 28, uf: "SP", municipio: "Santo André", nota: 33.142, porte: "+500 mil", regiao: "Sudeste" },
            { position: 29, uf: "SC", municipio: "Itajaí", nota: 32.923, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 30, uf: "SP", municipio: "Vinhedo", nota: 32.627, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 31, uf: "TO", municipio: "Palmas", nota: 32.625, porte: "100 a 500 mil", regiao: "Norte" },
            { position: 32, uf: "ES", municipio: "Vila Velha", nota: 32.619, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 33, uf: "RS", municipio: "Porto Alegre", nota: 32.553, porte: "+500 mil", regiao: "Sul" },
            { position: 34, uf: "MT", municipio: "Cuiabá", nota: 32.414, porte: "+500 mil", regiao: "Centro-Oeste" },
            { position: 35, uf: "SP", municipio: "São José dos Campos", nota: 32.407, porte: "+500 mil", regiao: "Sudeste" },
            { position: 36, uf: "SC", municipio: "Joinville", nota: 32.342, porte: "+500 mil", regiao: "Sul" },
            { position: 37, uf: "SP", municipio: "Praia Grande", nota: 32.285, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 38, uf: "PR", municipio: "Foz do Iguaçu", nota: 32.220, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 39, uf: "SP", municipio: "Louveira", nota: 32.143, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 40, uf: "SP", municipio: "Ribeirão Preto", nota: 32.102, porte: "+500 mil", regiao: "Sudeste" },
            { position: 41, uf: "ES", municipio: "Cachoeiro de Itapemirim", nota: 32.026, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 42, uf: "RJ", municipio: "Petrópolis", nota: 32.012, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 43, uf: "SP", municipio: "Paulínia", nota: 31.954, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 44, uf: "MG", municipio: "Uberlândia", nota: 31.759, porte: "+500 mil", regiao: "Sudeste" },
            { position: 45, uf: "MG", municipio: "Varginha", nota: 31.744, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 46, uf: "PR", municipio: "Ponta Grossa", nota: 31.714, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 47, uf: "SP", municipio: "São Bernardo do Campo", nota: 31.611, porte: "+500 mil", regiao: "Sudeste" },
            { position: 48, uf: "SP", municipio: "Barretos", nota: 31.557, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 49, uf: "SP", municipio: "Indaiatuba", nota: 31.536, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 50, uf: "PR", municipio: "Cascavel", nota: 31.463, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 51, uf: "GO", municipio: "Anápolis", nota: 31.367, porte: "100 a 500 mil", regiao: "Centro-Oeste" },
            { position: 52, uf: "RS", municipio: "Caxias do Sul", nota: 31.205, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 53, uf: "SP", municipio: "São Sebastião", nota: 31.152, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 54, uf: "GO", municipio: "Rio Verde", nota: 31.024, porte: "100 a 500 mil", regiao: "Centro-Oeste" },
            { position: 55, uf: "SP", municipio: "Limeira", nota: 31.006, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 56, uf: "SC", municipio: "Criciúma", nota: 30.805, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 57, uf: "PR", municipio: "Apucarana", nota: 30.796, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 58, uf: "SP", municipio: "Mogi das Cruzes", nota: 30.764, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 59, uf: "PR", municipio: "Pinhais", nota: 30.703, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 60, uf: "AL", municipio: "Maceió", nota: 30.654, porte: "+500 mil", regiao: "Nordeste" },
            { position: 61, uf: "SP", municipio: "Pindamonhangaba", nota: 30.582, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 62, uf: "MS", municipio: "Três Lagoas", nota: 30.469, porte: "100 a 500 mil", regiao: "Centro-Oeste" },
            { position: 63, uf: "SP", municipio: "Itu", nota: 30.465, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 64, uf: "MT", municipio: "Primavera do Leste", nota: 30.437, porte: "50 a 100 mil", regiao: "Centro-Oeste" },
            { position: 65, uf: "PR", municipio: "Umuarama", nota: 30.279, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 66, uf: "PI", municipio: "Teresina", nota: 30.177, porte: "+500 mil", regiao: "Nordeste" },
            { position: 67, uf: "MG", municipio: "Betim", nota: 30.166, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 68, uf: "SP", municipio: "Atibaia", nota: 30.126, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 69, uf: "SC", municipio: "Chapecó", nota: 30.117, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 70, uf: "SP", municipio: "Taubaté", nota: 30.114, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 71, uf: "SP", municipio: "Lençóis Paulista", nota: 30.111, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 72, uf: "MG", municipio: "Uberaba", nota: 30.095, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 73, uf: "SP", municipio: "Valinhos", nota: 30.092, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 74, uf: "ES", municipio: "Serra", nota: 30.063, porte: "+500 mil", regiao: "Sudeste" },
            { position: 75, uf: "SP", municipio: "Itatiba", nota: 30.041, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 76, uf: "SE", municipio: "Aracaju", nota: 30.040, porte: "+500 mil", regiao: "Nordeste" },
            { position: 77, uf: "MT", municipio: "Lucas do Rio Verde", nota: 30.039, porte: "50 a 100 mil", regiao: "Centro-Oeste" },
            { position: 78, uf: "SP", municipio: "Piracicaba", nota: 30.034, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 79, uf: "PB", municipio: "João Pessoa", nota: 29.931, porte: "+500 mil", regiao: "Nordeste" },
            { position: 80, uf: "SP", municipio: "Osasco", nota: 29.843, porte: "+500 mil", regiao: "Sudeste" },
            { position: 81, uf: "ES", municipio: "Linhares", nota: 29.812, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 82, uf: "GO", municipio: "Aparecida de Goiânia", nota: 29.805, porte: "+500 mil", regiao: "Centro-Oeste" },
            { position: 83, uf: "SP", municipio: "Araraquara", nota: 29.794, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 84, uf: "SP", municipio: "Caraguatatuba", nota: 29.770, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 85, uf: "SP", municipio: "São José do Rio Preto", nota: 29.746, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 86, uf: "MG", municipio: "Juiz de Fora", nota: 29.678, porte: "+500 mil", regiao: "Sudeste" },
            { position: 87, uf: "RR", municipio: "Boa Vista", nota: 29.650, porte: "100 a 500 mil", regiao: "Norte" },
            { position: 88, uf: "AM", municipio: "Manaus", nota: 29.556, porte: "+500 mil", regiao: "Norte" },
            { position: 89, uf: "SP", municipio: "Presidente Prudente", nota: 29.531, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 90, uf: "RS", municipio: "Canoas", nota: 29.483, porte: "100 a 500 mil", regiao: "Sul" },
            { position: 91, uf: "GO", municipio: "Itumbiara", nota: 29.482, porte: "100 a 500 mil", regiao: "Centro-Oeste" },
            { position: 92, uf: "RJ", municipio: "Macaé", nota: 29.424, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 93, uf: "RJ", municipio: "Saquarema", nota: 29.365, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 94, uf: "SP", municipio: "Diadema", nota: 29.353, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 95, uf: "MG", municipio: "Contagem", nota: 29.331, porte: "+500 mil", regiao: "Sudeste" },
            { position: 96, uf: "SP", municipio: "Jacareí", nota: 29.330, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 97, uf: "SP", municipio: "Cajamar", nota: 29.231, porte: "50 a 100 mil", regiao: "Sudeste" },
            { position: 98, uf: "SP", municipio: "São Carlos", nota: 29.205, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 99, uf: "SP", municipio: "Americana", nota: 29.167, porte: "100 a 500 mil", regiao: "Sudeste" },
            { position: 100, uf: "SP", municipio: "Guarujá", nota: 29.153, porte: "100 a 500 mil", regiao: "Sudeste" }
        ];

        let currentView = 'initial';
        let currentDashboardView = 'axes';
        let filteredData = [...indicatorsData];
        let chartInstances = {};

        // Variáveis globais para a seleção de município
        let allStates = [];
        let selectedState = null;
        let selectedMunicipalityData = null;

        // Initialize the page
        function init() {
            populateIndicatorsTable();
            renderAxisCards();
            loadStates();
            populateRankingTable();
            populateUFDropdowns();
            renderCSCSummary();
        }

        // Carregar estados da API do IBGE
        async function loadStates() {
            try {
                const response = await fetch('https://servicodados.ibge.gov.br/api/v1/localidades/estados?orderBy=nome');
                const states = await response.json();
                
                allStates = states;
                populateStatesDropdown(states);
                populateUFDropdowns(); // Populate UF dropdown for ranking
            } catch (error) {
                console.error('Erro ao carregar estados:', error);
                document.getElementById('uf-select').innerHTML = '<option value="">Erro ao carregar estados</option>';
            }
        }

        // Popular dropdown de estados
        function populateStatesDropdown(states) {
            const ufSelect = document.getElementById('uf-select');
            ufSelect.innerHTML = '<option value="">Selecione o Estado</option>';
            
            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state.id;
                option.textContent = `${state.nome} (${state.sigla})`;
                ufSelect.appendChild(option);
            });
        }

        // Popular dropdowns de UF para o ranking
        function populateUFDropdowns() {
            const ufSelectRanking = document.getElementById('ranking-uf');
            
            // Adicionar opção padrão
            ufSelectRanking.innerHTML = '<option value="">Todos os estados</option>';
            
            // Adicionar todos os estados
            allStates.forEach(state => {
                const option = document.createElement('option');
                option.value = state.sigla;
                option.textContent = state.sigla;
                ufSelectRanking.appendChild(option);
            });
        }

        // Selecionar UF e carregar municípios
        async function selectUF() {
            const ufSelect = document.getElementById('uf-select');
            const municipalitySelect = document.getElementById('municipality-select');
            const selectedStateId = ufSelect.value;

            if (!selectedStateId) {
                municipalitySelect.innerHTML = '<option value="">Primeiro selecione o estado</option>';
                municipalitySelect.disabled = true;
                selectedState = null;
                hideSelection();
                return;
            }

            // Encontrar o estado selecionado
            selectedState = allStates.find(state => state.id == selectedStateId);
            
            // Mostrar loading
            municipalitySelect.innerHTML = '<option value="">Carregando municípios...</option>';
            municipalitySelect.disabled = true;

            try {
                // Carregar municípios do estado selecionado
                const response = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${selectedStateId}/municipios?orderBy=nome`);
                const municipalities = await response.json();
                
                // Popular dropdown de municípios
                municipalitySelect.innerHTML = '<option value="">Selecione o Município</option>';
                municipalities.forEach(municipality => {
                    const option = document.createElement('option');
                    option.value = municipality.id;
                    option.textContent = municipality.nome;
                    option.dataset.municipalityData = JSON.stringify(municipality);
                    municipalitySelect.appendChild(option);
                });
                
                municipalitySelect.disabled = false;
                
            } catch (error) {
                console.error('Erro ao carregar municípios:', error);
                municipalitySelect.innerHTML = '<option value="">Erro ao carregar municípios</option>';
            }
        }

        // Selecionar município do dropdown
        function selectMunicipality() {
            const municipalitySelect = document.getElementById('municipality-select');
            const selectedOption = municipalitySelect.options[municipalitySelect.selectedIndex];
            
            if (!selectedOption.value) {
                hideSelection();
                return;
            }

            selectedMunicipalityData = JSON.parse(selectedOption.dataset.municipalityData);
            showSelection();
            
            // Verificar se é Londrina-PR e desbloquear conteúdo
            if (selectedMunicipalityData.nome.toLowerCase() === 'londrina' && 
                selectedMunicipalityData.microrregiao.mesorregiao.UF.sigla.toUpperCase() === 'PR') {
                unlockContent();
            } else {
                showFutureImplementation();
            }
        }

        // Mostrar seleção
        function showSelection() {
            if (!selectedMunicipalityData) return;

            const selectionDisplay = document.getElementById('selection-display');
            const selectionText = document.getElementById('selection-text');
            const state = selectedMunicipalityData.microrregiao.mesorregiao.UF;
            
            selectionText.innerHTML = `<strong>${selectedMunicipalityData.nome}</strong> - ${state.nome} (${state.sigla})`;
            selectionDisplay.classList.add('show');
            // Hide CSC summary when a municipality is selected
            const summary = document.getElementById('csc-summary');
            if (summary) summary.classList.add('hidden');

            // Also hide the global ranking section if present
            const globalRanking = document.getElementById('ranking-section');
            if (globalRanking) globalRanking.classList.add('hidden');

            // Reset municipality view selector to 'axes' and show axes view
            const muniViewSelector = document.getElementById('municipality-view-selector');
            if (muniViewSelector) {
                muniViewSelector.value = 'axes';
                changeView();
            }
        }

        // Esconder seleção
        function hideSelection() {
            document.getElementById('selection-display').classList.remove('show');
            selectedMunicipalityData = null;
            // Show CSC summary when selection is cleared
            const summary = document.getElementById('csc-summary');
            if (summary) summary.classList.remove('hidden');
        }

        // Desbloquear conteúdo para Londrina
        function unlockContent() {
            // Mostrar a dashboard
            document.getElementById('municipality-dashboard').classList.remove('hidden');
            // Esconder a mensagem de implementação futura
            document.getElementById('future-implementation-message').classList.add('hidden');
            
            // Atualizar o nome do município no dashboard
            document.getElementById('selected-municipality').textContent = 'Londrina - PR';
            
            // Mostrar informações de ranking de Londrina
            document.getElementById('city-ranking-info').classList.remove('hidden');
            // Hide CSC summary when showing municipality dashboard
            const summary = document.getElementById('csc-summary');
            if (summary) summary.classList.add('hidden');
        }

        // Mostrar mensagem de implementação futura
        function showFutureImplementation() {
            // Esconder a dashboard
            document.getElementById('municipality-dashboard').classList.add('hidden');
            // Mostrar a mensagem de implementação futura
            document.getElementById('future-implementation-message').classList.remove('hidden');
            
            // Esconder informações de ranking
            document.getElementById('city-ranking-info').classList.add('hidden');
            // Hide CSC summary when a municipality is selected (even if data unavailable)
            const summary = document.getElementById('csc-summary');
            if (summary) summary.classList.add('hidden');
        }

        // Limpar seleção
        function clearSelection() {
            // Resetar seleções
            selectedMunicipalityData = null;
            selectedState = null;
            
            // Resetar dropdowns
            document.getElementById('uf-select').value = '';
            document.getElementById('municipality-select').value = '';
            document.getElementById('municipality-select').innerHTML = '<option value="">Primeiro selecione o estado</option>';
            document.getElementById('municipality-select').disabled = true;
            
            // Esconder seleção
            hideSelection();
            
            // Esconder a dashboard e a mensagem de implementação futura
            document.getElementById('municipality-dashboard').classList.add('hidden');
            document.getElementById('future-implementation-message').classList.add('hidden');
            
            // Esconder informações de ranking
            document.getElementById('city-ranking-info').classList.add('hidden');
            // Show CSC summary again
            const summary = document.getElementById('csc-summary');
            if (summary) summary.classList.remove('hidden');
        }

        // Mostrar a própria seção de resumo CSC (local) e garantir ranking escondido
        function showCSCSummaryView() {
            const btnSummary = document.getElementById('btn-summary');
            const btnRanking = document.getElementById('btn-ranking');
            if (btnSummary) btnSummary.classList.add('active');
            if (btnRanking) btnRanking.classList.remove('active');

            // Ensure ranking section (global) is visible/hidden accordingly
            const rankingSection = document.getElementById('ranking-section');
            // When showing the summary view, hide the global ranking so it doesn't conflict with municipal dashboard
            if (rankingSection) rankingSection.classList.add('hidden');
        }

        // Abrir a visualização do ranking CSC (leva o usuário para a seção de ranking)
        function showCSCRankingView() {
            const btnSummary = document.getElementById('btn-summary');
            const btnRanking = document.getElementById('btn-ranking');
            if (btnSummary) btnSummary.classList.remove('active');
            if (btnRanking) btnRanking.classList.add('active');

            // Ensure ranking section is visible and scroll to it
            const rankingSection = document.getElementById('ranking-section');
            if (rankingSection) {
                rankingSection.classList.remove('hidden');
                rankingSection.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Render CSC summary (totais e por eixo)
        function renderCSCSummary() {
            const total = indicatorsData.length;
            const grouped = indicatorsData.reduce((acc, cur) => {
                const eixo = cur.eixo || 'OUTROS';
                acc[eixo] = (acc[eixo] || 0) + 1;
                return acc;
            }, {});

            const statsEl = document.getElementById('csc-summary-stats');
            const axisGrid = document.getElementById('csc-summary-axisgrid');
            if (!statsEl || !axisGrid) return;

            statsEl.innerHTML = '';
            axisGrid.innerHTML = '';

            // Total card
            const totalCard = document.createElement('div');
            totalCard.style.minWidth = '260px';
            totalCard.style.padding = '18px';
            totalCard.style.borderRadius = '12px';
            totalCard.style.background = 'linear-gradient(90deg, #513C9A, #6B4FB5)';
            totalCard.style.color = 'white';
            totalCard.style.textAlign = 'center';
            totalCard.innerHTML = `<div style="font-size:18px;font-weight:700;margin-bottom:6px;">Indicadores no CSC</div><div style="font-size:28px;font-weight:800;">${total}</div>`;
            statsEl.appendChild(totalCard);

            // Use eixosData order when possible
            (eixosData || Object.keys(grouped).map(k=>({eixo:k, name:k}))).forEach(e => {
                const code = e.eixo || e;
                const name = e.name || getAxisName(code) || code;
                const count = grouped[code] || 0;

                const card = document.createElement('div');
                card.className = 'axis-card';
                card.style.minWidth = '220px';
                card.innerHTML = `
                    <div class="axis-title">${name}</div>
                    <div style="font-size:24px; font-weight:800; color:#513C9A; text-align:center;">${count}</div>
                `;
                axisGrid.appendChild(card);
            });
        }

        // Alternar visibilidade do ranking
        function toggleRanking() {
            const rankingSection = document.getElementById('ranking-section');
            rankingSection.classList.toggle('hidden');
        }

        // Render axis cards
        function renderAxisCards() {
            // Prefer the municipality axes container (#axes .axis-grid) when in municipality dashboard,
            // otherwise fill the summary axis grid (#csc-summary-axisgrid)
            let axisGrid = document.querySelector('#axes .axis-grid');
            if (!axisGrid) axisGrid = document.getElementById('csc-summary-axisgrid') || document.querySelector('.axis-grid');
            if (!axisGrid) return;

            axisGrid.innerHTML = '';

            eixosData.forEach(eixo => {
                const card = document.createElement('div');
                card.className = 'axis-card';
                card.innerHTML = `
                    <div class="axis-title">${eixo.name}</div>
                    <div class="axis-values">
                        <div class="year-value">
                            <div class="year">2022</div>
                            <div class="${typeof eixo.positions[0] === 'string' ? 'out-of-range' : 'value'}">${eixo.positions[0]}</div>
                        </div>
                        <div class="year-value">
                            <div class="year">2023</div>
                            <div class="${typeof eixo.positions[1] === 'string' ? 'out-of-range' : 'value'}">${eixo.positions[1]}</div>
                        </div>
                        <div class="year-value">
                            <div class="year">2024</div>
                            <div class="${typeof eixo.positions[2] === 'string' ? 'out-of-range' : 'value'}">${eixo.positions[2]}</div>
                        </div>
                    </div>
                `;
                axisGrid.appendChild(card);
            });
        }

        // Populate indicators table
        function populateIndicatorsTable() {
            const tbody = document.getElementById('indicators-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            filteredData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.name}</td>
                    <td><span class="eixo-badge eixo-${item.eixo}">${item.eixo}</span></td>
                    <td>${item.values[0]}</td>
                    <td>${item.values[1]}</td>
                    <td>${item.values[2]}</td>
                    <td>${item.unit}</td>
                    <td>${item.fonte}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Populate ranking table
        function populateRankingTable() {
            const tbody = document.getElementById('ranking-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            rankingData.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.position}°</td>
                    <td>${item.uf}</td>
                    <td>${item.municipio}</td>
                    <td>${item.nota}</td>
                    <td>${item.porte}</td>
                    <td>${item.regiao}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Filter indicators
        function filterIndicators() {
            const axisFilter = document.getElementById('axis-filter').value;
            const searchTerm = document.getElementById('indicator-search').value.toLowerCase();
            
            filteredData = indicatorsData.filter(item => {
                const matchesAxis = !axisFilter || item.eixo === axisFilter;
                const matchesSearch = !searchTerm || item.name.toLowerCase().includes(searchTerm);
                return matchesAxis && matchesSearch;
            });
            
            populateIndicatorsTable();
        }

        // Filter ranking
        function filterRanking() {
            const yearFilter = document.getElementById('ranking-year').value;
            const regionFilter = document.getElementById('ranking-region').value;
            const ufFilter = document.getElementById('ranking-uf').value;
            const sizeFilter = document.getElementById('ranking-size').value;
            
            // For now, we'll just filter the existing ranking data
            // In a real implementation, you would fetch different data based on the year
            let filteredRanking = [...rankingData];
            
            if (regionFilter) {
                filteredRanking = filteredRanking.filter(item => item.regiao === regionFilter);
            }
            
            if (ufFilter) {
                filteredRanking = filteredRanking.filter(item => item.uf === ufFilter);
            }
            
            if (sizeFilter) {
                filteredRanking = filteredRanking.filter(item => item.porte === sizeFilter);
            }
            
            const tbody = document.getElementById('ranking-tbody');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            filteredRanking.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item.position}°</td>
                    <td>${item.uf}</td>
                    <td>${item.municipio}</td>
                    <td>${item.nota}</td>
                    <td>${item.porte}</td>
                    <td>${item.regiao}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Change view based on dropdown selection
        function changeView() {
            const viewSelector = document.getElementById('municipality-view-selector');
            const selectedView = viewSelector.value;
            currentDashboardView = selectedView;
            
            // Hide all views including ranking
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Hide ranking section if it exists
            const rankingSection = document.getElementById('ranking-section');
            if (rankingSection) rankingSection.classList.add('hidden');
            
            // Show selected view if exists
            const targetView = document.getElementById(selectedView);
            if (targetView) targetView.classList.add('active');

            // If charts view is selected, hide charts area until user generates
            if (selectedView === 'charts') {
                const chartsSection = document.getElementById('charts-section');
                if (chartsSection) chartsSection.style.display = 'none';
            }

            // If axes view is selected, render axis cards to populate content
            if (selectedView === 'axes') {
                renderAxisCards();
            }
        }

        // Open tab (keeping for backward compatibility, but now controlled by dropdown)
        function openTab(tabName) {
            // Update dropdown to match
            document.getElementById('view-selector').value = tabName;
            changeView();
        }

        // Get axis name from code
        function getAxisName(eixoCode) {
            const eixoNames = {
                'SAU': 'Saúde',
                'GOV': 'Governança',
                'MOB': 'Mobilidade',
                'URB': 'Urbanismo',
                'MAM': 'Meio Ambiente',
                'EMP': 'Empreendedorismo',
                'ECO': 'Economia',
                'EDU': 'Educação',
                'TIC': 'Tecnologia',
                'SEG': 'Segurança'
            };
            return eixoNames[eixoCode] || eixoCode;
        }

        // Create charts for a given list of indicators into a container element
        function createChartsForIndicators(indicators, containerEl) {
            // Destroy existing charts
            Object.values(chartInstances).forEach(chartArray => {
                chartArray.forEach(chart => chart.destroy());
            });
            chartInstances = {};

            // Group by axis
            const grouped = {};
            indicators.forEach(ind => {
                const eixo = ind.eixo || 'OUTROS';
                if (!grouped[eixo]) grouped[eixo] = [];
                grouped[eixo].push(ind);
            });

            Object.keys(grouped).forEach(eixo => {
                const axisSection = document.createElement('div');
                axisSection.className = 'axis-charts-section';
                axisSection.id = `axis-${eixo}`;

                const axisName = getAxisName(eixo);
                axisSection.innerHTML = `<div class="axis-charts-header">${axisName}</div>`;

                const axisChartsGrid = document.createElement('div');
                axisChartsGrid.className = 'axis-charts-grid';

                grouped[eixo].forEach((indicator, idx) => {
                    const chartCard = document.createElement('div');
                    chartCard.className = 'chart-card';
                    const chartId = `sel_chart_${eixo}_${idx}_${Math.floor(Math.random()*10000)}`;
                    chartCard.innerHTML = `<h4>${indicator.name}</h4><canvas id="${chartId}"></canvas>`;
                    axisChartsGrid.appendChild(chartCard);

                    setTimeout(() => {
                        const ctx = document.getElementById(chartId);
                        if (!ctx) return;

                        const raw = indicator.values || [];
                        const hasNumber = raw.some(v => v !== '' && !isNaN(Number(v)));
                        const hasBoolean = raw.some(v => typeof v === 'string' && /^(sim|não|nao)$/i.test(v));

                        let dataValues = [];
                        let isBooleanSeries = false;

                        if (hasBoolean && !hasNumber) {
                            isBooleanSeries = true;
                            dataValues = raw.map(v => {
                                if (typeof v === 'string' && /^(sim)$/i.test(v)) return 1;
                                if (typeof v === 'string' && /^(não|nao)$/i.test(v)) return 0;
                                return null;
                            });
                        } else {
                            dataValues = raw.map(v => {
                                const n = Number(v);
                                return (v === '' || isNaN(n)) ? null : n;
                            });
                        }

                        const firstIdx = dataValues.findIndex(v => v !== null && v !== undefined);
                        const lastIdx = dataValues.length - 1 - [...dataValues].reverse().findIndex(v => v !== null && v !== undefined);
                        let trend = 'stable';
                        if (firstIdx === -1 || lastIdx === -1 || firstIdx === lastIdx) trend = 'stable';
                        else {
                            const firstVal = dataValues[firstIdx];
                            const lastVal = dataValues[lastIdx];
                            if (firstVal === null || lastVal === null) trend = 'stable';
                            else if (isBooleanSeries) {
                                if (lastVal > firstVal) trend = 'improving';
                                else if (lastVal < firstVal) trend = 'worsening';
                                else trend = 'stable';
                            } else {
                                const diff = lastVal - firstVal;
                                const eps = Math.max(1e-6, Math.abs(firstVal) * 1e-6);
                                trend = Math.abs(diff) <= eps ? 'stable' : (diff > 0 ? 'improving' : 'worsening');
                            }
                        }

                        const colors = {
                            improving: {border: '#28a745', bg: 'rgba(40,167,69,0.12)', point: '#28a745'},
                            worsening: {border: '#dc3545', bg: 'rgba(220,53,69,0.12)', point: '#dc3545'},
                            stable: {border: '#6c757d', bg: 'rgba(108,117,125,0.12)', point: '#6c757d'}
                        };
                        const colorSet = colors[trend] || colors.stable;

                        const dataset = {
                            label: indicator.unit || indicator.name,
                            data: dataValues,
                            backgroundColor: colorSet.bg,
                            borderColor: colorSet.border,
                            borderWidth: 3,
                            pointBackgroundColor: colorSet.point,
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointRadius: 6,
                            pointHoverRadius: 8,
                            fill: true,
                            tension: 0.4,
                            spanGaps: true
                        };

                        const chartConfig = {
                            type: 'line',
                            data: { labels: ['2022','2023','2024'], datasets: [dataset] },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: { legend: { display: true, position: 'top' } },
                                scales: { x: { ticks: { color: '#513C9A', font: { size:12, weight:'bold' } }, grid: { color: 'rgba(81, 60, 154, 0.05)' } }, y: { ticks: { color: '#513C9A' }, grid: { color: 'rgba(81, 60, 154, 0.05)' } } },
                                interaction: { mode: 'index', intersect: false },
                                elements: { point: { hoverRadius: 8 } }
                            }
                        };

                        if (isBooleanSeries) {
                            chartConfig.options.scales.y = { min:0, max:1, ticks:{ stepSize:1, callback: v=> v===1? 'Sim':'Não', color:'#513C9A', font:{size:12} }, grid:{ color: 'rgba(81, 60, 154, 0.05)' } };
                            chartConfig.options.plugins.tooltip = { callbacks: { label: ctx => { const v = ctx.raw; return v===1? 'Sim': v===0? 'Não':'N/A'; } } };
                        } else {
                            chartConfig.options.plugins = chartConfig.options.plugins || {};
                            chartConfig.options.plugins.tooltip = { callbacks: { label: ctx => ctx.formattedValue } };
                        }

                        try {
                            const chartInstance = new Chart(ctx, chartConfig);
                            if (!chartInstances[eixo]) chartInstances[eixo] = [];
                            chartInstances[eixo][idx] = chartInstance;
                        } catch (e) { console.error('Chart error', e); }
                    }, 80);
                });

                axisSection.appendChild(axisChartsGrid);
                containerEl.appendChild(axisSection);
            });
        }

        // Calculate trends (improving / worsening / stable) based on first vs last available values
        function calculateTrends(indicators) {
            const trends = { improving: [], worsening: [], stable: [] };

            indicators.forEach(ind => {
                // try to find numeric values across years (values may be in ind.values array)
                const vals = (ind.values || []).map(v => {
                    const n = parseFloat(v);
                    return isNaN(n) ? null : n;
                }).filter(v => v !== null);

                if (vals.length >= 2) {
                    const first = vals[0];
                    const last = vals[vals.length - 1];
                    const change = last - first;
                    const threshold = Math.abs(first) * 0.01; // 1% threshold

                    if (Math.abs(change) < threshold) trends.stable.push(ind);
                    else if (change > 0) trends.improving.push(ind);
                    else trends.worsening.push(ind);
                } else {
                    // fallback: treat as stable if not enough numeric points
                    trends.stable.push(ind);
                }
            });

            return trends;
        }

        // Existing generateCharts now uses all indicators
        function generateCharts() {
            const container = document.getElementById('charts-container');
            container.innerHTML = '';
            const chartsSection = document.getElementById('charts-section');
            if (chartsSection) {
                chartsSection.style.display = 'block';

                // render title (kept elsewhere in your layout if present)
                // render trends summary
                const trends = calculateTrends(indicatorsData);
                const trendsHtml = `
                    <div class="trends-grid">
                        <div class="trends-card improving">
                            <div class="trends-icon">📈</div>
                            <div class="trends-number">${trends.improving.length}</div>
                            <div class="trends-label">Melhorando</div>
                        </div>
                        <div class="trends-card worsening">
                            <div class="trends-icon">📉</div>
                            <div class="trends-number">${trends.worsening.length}</div>
                            <div class="trends-label">Piorando</div>
                        </div>
                        <div class="trends-card stable">
                            <div class="trends-icon">➡️</div>
                            <div class="trends-number">${trends.stable.length}</div>
                            <div class="trends-label">Estáveis</div>
                        </div>
                    </div>
                `;

                // insert trends above the charts container
                chartsSection.querySelectorAll('.trends-grid').forEach(n => n.remove());
                chartsSection.insertAdjacentHTML('afterbegin', trendsHtml);
            }

            createChartsForIndicators(indicatorsData, container);

            // Enable axis filter after generating charts
            const chartAxisFilter = document.getElementById('chart-axis-filter');
            if (chartAxisFilter) chartAxisFilter.disabled = false;
        }

        // Generate charts for currently filtered indicators in the Indicators tab
        function generateChartsFromFiltered() {
            const container = document.getElementById('charts-container');
            container.innerHTML = '';
            document.getElementById('charts-section').style.display = 'block';
            createChartsForIndicators(filteredData, container);
        }

        // Filter charts by axis
        function filterChartsByAxis() {
            const chartAxisFilter = document.getElementById('chart-axis-filter');
            if (!chartAxisFilter || chartAxisFilter.disabled) return;
            const selectedAxis = chartAxisFilter.value;
            const allAxisSections = document.querySelectorAll('.axis-charts-section');
            
            allAxisSections.forEach(section => {
                if (selectedAxis === '' || section.id === `axis-${selectedAxis}`) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        function resetPage() {
            window.location.href = '#'; // Altere para a URL correta
        }

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>